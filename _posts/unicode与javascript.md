---
title: 'Unicodeä¸Javascript'
img: new-zealand.jpg # Add image post (optional)
date: 2018-08-23 22:20:00 +0800
description: Youâ€™ll find this post in your `_posts` directory. Go ahead and edit it and re-build the site to see your changes. # Add post description (optional)
tag: [unicode, javascript]
---

# ES5 ä¸­çš„å­—ç¬¦æ“ä½œ

es5 ä¸­æä¾›äº†ä¸€äº›è·Ÿå­—ç¬¦ç›¸å…³çš„æ“ä½œï¼Œåœ¨æŸäº›éœ€è¦ç²¾ç»†åŒ–å¤„ç†å­—ç¬¦ä¸²çš„åœºæ‰€å¯èƒ½æœ‰å¸®åŠ©ã€‚

## å­—ç¬¦è½¬ä¹‰

å¯ä»¥ä½¿ç”¨`\u`æ¥è½¬ä¹‰å„ç§åå…­è¿›åˆ¶æ•°ä¸ºç›¸åº”å­—ç¬¦ï¼š

```js
'\u0041'; // A
'\u0061'; // a
'\u4E25'; // ä¸¥
'\u2603'; // â˜ƒ
```

## fromCharCodeã€charCodeAtã€charAtã€length

1.  `String.fromCharcode` - å¯ä»¥åŸºäºã€ä»£ç ç‚¹ã€åˆ›å»ºå­—ç¬¦ä¸²ï¼Œæš‚æ—¶å¯ä»¥æŠŠã€ä»£ç ç‚¹ã€ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶æ•°

    ```js
    String.fromCharCode(0x0041); // A
    String.fromCharCode(0x4e25); // ä¸¥
    ```

2.  `String.prototype.charAt(position)` è·å–å­—ç¬¦ä¸²åœ¨ç‰¹å®šä½ç½®çš„å­—ç¬¦

    ```js
    'ABCDE'.charAt(2); // C
    'ä¸‡å‡ çš®'.charAt(2); // çš®
    ```

3.  `String.prototype.charCodeAt(position)`ï¼Œä¸`charAt`ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯è·å–åœ¨ç‰¹å®šä½ç½®çš„é‚£ä¸ªå­—ç¬¦çš„ã€ä»£ç ç‚¹ã€ã€‚åŒæ—¶å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºæ¥è¿™ä¸ªæ–¹æ³•æ˜¯`fromCharCode`çš„åå‘æ“ä½œã€‚

    ```js
    'ABCDE'.charCodeAt(2).toString(16); // 0x0043
    'ä¸‡å‡ çš®'.charCodeAt(2).toString(16); // 0x76AE

    // éªŒè¯åå‘æ“ä½œ
    String.fromCharCode('ä¸‡å‡ çš®'.charCodeAt(2)); // "çš®"
    ```

4.  `length`å±æ€§å¾ˆç†Ÿæ‚‰äº†ï¼Œå°±æ˜¯è®¡ç®—é•¿åº¦å‘—

```js
'ABCDE'.length; // 5
'ä¸‡å‡ çš®'.length; // 3
```

# é‡åˆ° Unicode å­—ç¬¦æ—¶é‡åˆ°çš„é—®é¢˜

åˆ°ç›®å‰ä¸ºå‡†éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé…åˆ`String.prototype`ä¸Šçš„å„ç§å·¥å…·æ–¹æ³•ï¼Œå¯ä»¥å¤„ç†å„ç§å„æ ·å¸¸è§å­—ç¬¦ä¸²æ“ä½œã€‚ä¸è¿‡éšç€`emoji`è¡¨æƒ…çš„ç››è¡Œï¼Œæ…¢æ…¢å°±ä¼šå‘ç°å·²æœ‰çš„å·¥å…·å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ã€‚

## fromCharCodeã€charCodeAt çš„åå‘æ“ä½œ

å…ˆçœ‹çœ‹ä¸Šé¢çš„åå‘æ“ä½œè¿˜èƒ½ä¸èƒ½å·¥ä½œï¼š

```js
String.fromCharCode('ğŸ’©'.charCodeAt(0)); // "ï¿½"
```

ç»“æœæ˜¯ä¹±ç ï¼Ÿï¼Ÿï¼Ÿ

é‚£ä¹ˆå†çœ‹çœ‹`length`ï¼š

```js
'ğŸ’©'.length; // 2
```

å› å¹ä¸åœï¼Œçœ‹æ¥é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ï¼Œå¦‚æœç»§ç»­å°è¯•ï¼Œå¯ä»¥å‘ç°ä¸€äº›å…¶ä»–çš„ã€BUGã€ï¼š

## ç¿»è½¬å­—ç¬¦ä¸²

ç¿»è½¬å­—ç¬¦ä¸²å¯èƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„å­—ç¬¦ä¸²æ“ä½œï¼Œé€šå¸¸å¯èƒ½æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„å·¥å…·å‡½æ•°ï¼š

```js
function reverse(str) {
  return str
    .split('')
    .reverse()
    .join('');
}

reverse('abc'); // 'cba'
reverse('ä¸‡å‡ çš®'); // "çš®å‡ ä¸‡"
```

å¦‚æœç”¨æ¥æ“ä½œè¡¨æƒ…å‘¢ï¼Ÿ

```js
reverse('ğŸ’©');
('ï¿½ï¿½');
```

æ„Ÿè§‰å¥½åƒè¡¨æƒ…è¢«æ‹†æ•£æˆäº† 2 ä¸ªå¥‡æ€ªçš„å­—ç¬¦ã€‚

åœ¨æ­£åˆ™åŒ¹é…æ—¶ï¼Œä¹Ÿæœ‰å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿ

## æ­£åˆ™åŒ¹é…

### èŒƒå›´åŒ¹é…

æ­£åˆ™è¡¨è¾¾å¼ä¸­ç»å¸¸ä¼šç”¨åˆ°èŒƒå›´åŒ¹é…ï¼š

```js
/[a-c]/.test('a') // true
/[æˆ‘-çš®]/.test('çš®') // true
```

ä½†æ˜¯è¿™ç§æ–¹æ³•åœ¨é‡åˆ°è¡¨æƒ…æ—¶å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼š

```js
/[ğŸ’©-ğŸ’«]/;
// Uncaught SyntaxError: Invalid regular expression: /[ğŸ’©-ğŸ’«]/: Range out of order in character class
```

å›§ï¼Œç«Ÿç„¶ç›´æ¥å°±æŠ¥é”™äº†ã€‚ã€‚

### æ•°é‡åŒ¹é…

æ­£åˆ™ä¸­å¯ä»¥ç”¨ä¸€äº›é‡è¯æ¥åŒ¹é…æŸä¸ªé€‰é¡¹å¤šæ¬¡,å¦‚`*`,`+`,Â `?`,Â `{n}`,Â `{n,}`,Â `{n,m}`ï¼Œè¿™äº›åœ¨å¤„ç†ã€å¸¸è§æ™®é€šã€å­—ç¬¦æ—¶æ²¡é—®é¢˜ï¼š

```js
/a{2}/.test('aa') //true
/çš®{2}/.test('çš®çš®') //true
```

ä¸å‡ºæ„æ–™ï¼Œé‡åˆ°è¡¨æƒ…ä¹Ÿä¼šå‡ºé—®é¢˜ï¼š

```js
/ğŸ’©{2}/.test('ğŸ’©ğŸ’©'); // false
```

ç§ç§å¥‡æ€ªçš„ç°è±¡éƒ½è¡¨æ˜ï¼Œjs åœ¨å¤„ç† emoji æ—¶æœ‰é—®é¢˜ï¼Œè€Œè¿™ç§ç°è±¡åœ¨æ™®é€šè‹±æ–‡å­—æ¯å’Œæ±‰å­—ä¸Šä¸ä¼šå­˜åœ¨ï¼Œè€Œè„‘æµ·é‡Œè·Ÿ emoji æœ€ç›¸å…³çš„å°±æ˜¯ Unicode äº†ï¼Œçœ‹æ¥æœ‰å¿…è¦äº†è§£ä¸‹ Unicodeã€‚é‚£ Unicode åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ

# Unicode ç®€ä»‹

Unicode æ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼ˆæ³¨æ„ä¸æ˜¯ç¼–ç æ–¹å¼ï¼Œæ—¶ä¸æ—¶å¬åˆ°æœ‰äººè¯´ Unicode ç¼–ç ï¼Œå®é™…ä¸Šæ˜¯ä¸æ­£ç¡®çš„è¯´æ³•ï¼‰ï¼Œå®ƒæŠŠç›®å‰ä¸–ç•Œä¸Šæ‰€æœ‰å­—ç¬¦åŒ…å«åœ¨å†…äº†ã€‚æ¯ä¸ªç¬¦å·éƒ½ä¸ä¸€ä¸ªç§°ä¸ºä»£ç ç‚¹ï¼ˆ`Code Point`ï¼‰çš„åå…­è¿›åˆ¶æ•°å¯¹åº”ï¼Œä»£ç ç‚¹é€šå¸¸æœ‰ä¸€ä¸ª`U+`å‰ç¼€ï¼Œä¾‹å¦‚ï¼š

```js
U+0041 =>  A
U+0061 =>   a
U+2603 =>   â˜ƒ
```

[codepoints](https://codepoints.net/)ä¸Šå¯ä»¥æµè§ˆå„ç§å„æ ·çš„ Unicode å­—ç¬¦ï¼Œæˆ‘ä»¬ ğŸ’© å…ˆç”Ÿçš„ä»£ç ç‚¹æ˜¯`U+1F4A9`~~~

Code Point çš„å–å€¼èŒƒå›´æ˜¯`U+0000`~`U+10FFFF`ï¼Œå¤§çº¦æœ‰ 110 ä¸‡ä¸ªã€‚ ä¸ºäº†å¥½ç»„ç»‡ï¼Œæ‰€æœ‰`Code Point`è¢«åˆ†ä¸ºäº† 17 ä¸ª`Plane`ï¼Œæ¯ä¸ª`Plane`ä¸­å¤§çº¦åŒ…å« 65K ä¸ª`Code Point`ã€‚ è§[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Unicode)

![](https://hellogithub2014.github.io/assets/img/Unicode/Unicode%20Panel.png)

å…¶ä¸­ç¬¬ä¸€ä¸ª`Plane`ï¼ˆU+0000~ U+FFFFï¼‰è¢«ç§°ä¸º`BMP`ï¼ˆ`Basic Multilingual Plane`ï¼‰,åŒ…å«äº†å‡ ä¹æ‰€æœ‰çš„å¸¸ç”¨å­—ç¬¦ã€‚

å‰©ä¸‹çš„å…¶ä»–`Plane`ï¼ˆU+10000~ U+10FFFFï¼‰è¢«ç§°ä¸º`supplementary planesï¼ˆSMPï¼‰`æˆ–è€… Â `astral planes`ï¼Œå¯¹åº”çš„å­—ç¬¦é€šå¸¸ç§°ä¸º`SMPå­—ç¬¦`ã€‚

å¦ï¼š æ±‰å­—çš„ Unicode ç ç‚¹èŒƒå›´[å¯ä»¥å‚ç…§è¿™é‡Œ](http://www.qqxiuzi.cn/zh/hanzi-unicode-bianma.php)

å…³äº Unicode å…ˆä»‹ç»è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯ï¼Œè¿™ä¸ªè·Ÿä¸Šé¢é‡åˆ°çš„é‚£äº› BUG æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿè¿™å°±è¦ä» js å†…éƒ¨å¯¹å­—ç¬¦çš„è¡¨ç¤ºè¯´èµ·äº†ã€‚

# js å†…éƒ¨çš„å­—ç¬¦è¡¨ç¤º

ä¸Šé¢è¯´åˆ° Unicode åªæ˜¯å­—ç¬¦é›†ï¼Œåœ¨è®¡ç®—æœºå†…éƒ¨ä¸ä¼šç›´æ¥å­˜å‚¨å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œè€Œæ˜¯ä¼šé€šè¿‡æŸç§ç¼–ç æŠŠå®ƒè½¬æ¢ä¸ºä¸€ä¸ªä¸ªå­—èŠ‚ã€‚å¯¹äºå¤§éƒ¨åˆ†å¸¸è§çš„å­—ç¬¦ï¼Œéƒ½æ˜¯ç”¨ 2 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ï¼›è€Œå¯¹äº emoji è¡¨æƒ…ï¼Œå¯èƒ½æœ‰äººå·²ç»çŒœåˆ°äº†ï¼Œæ˜¯ç”¨ 4 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ã€‚

æ›´å…·ä½“çš„æ¥è¯´ï¼š å¯¹äº`SMPå­—ç¬¦`ï¼ŒJavaScript å®é™…ä¸ŠæŠŠå®ƒæ‹†æˆäº†ä¸Šä¸‹ä¸¤åŠï¼ˆ`H`ã€`L`ï¼‰åˆ†åˆ«æ¥è¡¨ç¤ºï¼Œ`H` å’Œ `L`éƒ½æ˜¯ 2 ä¸ªå­—èŠ‚çš„ã€‚

Hã€L çš„è®¡ç®—å…¬å¼ï¼š

```js
H = Math.floor((C - 0x10000) / 0x400) + 0xd800;
L = ((C - 0x10000) % 0x400) + 0xdc00;
```

å› ä¸º `SMPå­—ç¬¦` çš„èŒƒå›´æ˜¯`U+010000 â†’ U+10FFFF`ï¼Œæ•…

`H`çš„èŒƒå›´å°±æ˜¯ `0xD800`~`0xDBFF`ï¼Œ ä¸€å…± 2^10 ä¸ªå­—ç¬¦
`L`çš„èŒƒå›´å°±æ˜¯ `0xDC00` ~ `0xDFFF`ï¼Œä¸€å…± 2^10 ä¸ªå­—ç¬¦

è²Œä¼¼å¾ˆå·§åˆçš„æ˜¯ï¼šå› ä¸º`SMPå­—ç¬¦`çš„èŒƒå›´æ˜¯`U+10000`~`U+10FFFF`,ä¸€å…± 2^20 ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ H å’Œ L ç»“åˆèµ·æ¥ï¼Œæ­£å·§èƒ½è¡¨ç¤ºå…¨éƒ¨çš„`SMPå­—ç¬¦`ã€‚è€Œ BMP ä¸­`U+D800`åˆ°`U+DFFF`æ˜¯ä¸€ä¸ªç©ºæ®µï¼Œé‡Œé¢ä¸å¯¹åº”ä»»ä½•å­—ç¬¦ã€‚

ä¾‹å¦‚å¯¹äº"ğŸ’©"(0x1F4A9)ï¼Œé€šè¿‡ä¸Šé¢å…¬å¼è®¡ç®—å¯ä»¥å¾—åˆ°`H = 0xD83D`ã€`L = 0xDCA9`ï¼Œä¹Ÿå°±æ˜¯è¯´ js å†…éƒ¨ä¼šä½¿ç”¨`0xD83D`å’Œ`0xDCA9`ä¸€å…± 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå®ƒã€‚

åŒæ—¶ï¼Œå¯¹äº BMP åŒºé—´çš„ä»£ç ç‚¹ï¼Œjs ä¸­ä¼šç›´æ¥å°†ç ç‚¹è½¬ä¸ºåå…­è¿›åˆ¶å½¢å¼çš„ 2 å­—èŠ‚ï¼š

```js
U+4E25  => 0x4E25
```

æˆ‘ä»¬ä¸Šé¢ç¢°åˆ°çš„æ‰€æœ‰`SMPå­—ç¬¦`BUG éƒ½æ˜¯å› ä¸º Hã€L å¯¼è‡´ï¼Œç†è§£äº†è¿™ä¸ªä¹Ÿå°±çŸ¥é“è¯¥å¦‚ä½•è§£å†³äº†ã€‚ ä¸è¿‡åœ¨æƒ³åŠæ³•è§£å†³å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬æ¥æ­£é¢å›ç­”ä¸€ä¸‹ï¼Œ**js å†…éƒ¨æ˜¯ä½¿ç”¨ä»€ä¹ˆç¼–ç æ–¹å¼å¤„ç†å­—ç¬¦çš„ï¼Ÿ**

## js ä¸­çš„å­—ç¬¦ç¼–ç 

å¥½å§ï¼Œè¿™å—çš„çŸ¥è¯†æ˜¯ä»[é˜®è€å¸ˆçš„è¿™ç¯‡åšå®¢](http://www.ruanyifeng.com/blog/2014/12/unicode.html)äº†è§£åˆ°çš„ï¼Œæˆ‘ç›´æ¥è¯´ç»“è®ºå§ã€‚

js ä½¿ç”¨çš„å…¶å®æ˜¯`UCS-2`ç¼–ç ï¼Œç”±äºè¿™ç§ç¼–ç è¢«æ•´åˆè¿›äº†`UTF-16`ç¼–ç ï¼Œä¹Ÿå¯ä»¥è®¤ä¸º js ä½¿ç”¨çš„æ˜¯`UTF-16`ç¼–ç å¤„ç†å­—ç¬¦ã€‚ä¸è¿‡åœ¨ç»†èŠ‚ä¸Šè¿™ä¸¤ç§ç¼–ç è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼š

**UTF-16 ç¼–ç å¯¹äºåŸºæœ¬å¹³é¢çš„å­—ç¬¦å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå¯¹äºè¾…åŠ©å¹³é¢çš„å­—ç¬¦å ç”¨ 4 ä¸ªå­—èŠ‚ï¼›** ä¹Ÿå°±æ˜¯è¯´ï¼šå¯¹äº"ğŸ’©"ï¼Œ`UTF-16`ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œå ç”¨ 4 ä¸ªå­—èŠ‚ã€‚

**è€Œ UCS-2 è®¤ä¸ºæ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ 2 ä¸ªå­—èŠ‚**ï¼Œè€Œå¯¹äºè¾…åŠ©å¹³é¢çš„å­—ç¬¦ä¾‹å¦‚ ğŸ’©ï¼Œå°±æ¯”è¾ƒå°´å°¬äº†ï¼ŒUCS-2 è®¤ä¸ºå®ƒæ˜¯ 2 ä¸ªå­—ç¬¦ï¼ˆH å’Œ Lï¼‰ï¼Œæ¯ä¸ªå­—ç¬¦å  2 ä¸ªå­—èŠ‚ã€‚

### UTF-16 ç¼–ç 

å†ç¨å¾®è¯´ä¸€ä¸‹`UTF-16`ç¼–ç ï¼ŒçŸ¥é“äº† Hã€Lï¼Œç†è§£`UTF-16`å°±å¾ˆå®¹æ˜“äº†ã€‚ä¸Šé¢æåˆ°å®ƒæ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç ï¼Œç»“æœå¯èƒ½æ˜¯ 2 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯èƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ã€‚

å…·ä½“æ¥è¯´ï¼š

1. å¦‚æœæ˜¯ BMP å­—ç¬¦ï¼Œé‚£ä¹ˆå…¶ä»£ç ç‚¹å°±æ˜¯ç¼–ç ç»“æœï¼Œå¦‚`U+4E25 => 0x4E25`
2. å¦‚æœæ˜¯ SMP å­—ç¬¦ï¼Œé‚£ä¹ˆè®¡ç®— Hã€Lï¼ŒH å’Œ L æ‹¼å‡‘èµ·æ¥çš„ 4 ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯æœ€ç»ˆç»“æœï¼Œå¦‚`0x1F4A9`çš„ç»“æœå°±æ˜¯`0xD83DDCA9`

# es5 ä¸­å¤„ç†`SMPå­—ç¬¦`

1. **length**ï¼šğŸ’© çš„`length`ä¸º 2 åº”è¯¥å¯ä»¥ç†è§£äº†ï¼Œå®é™…ä¸Šå®ƒæ˜¯ Hã€L ä¸¤ä¸ªå­—ç¬¦ï¼Œå¯ä»¥çœ‹å‡º`length`çš„ç»“æœå¹¶ä¸æ˜¯è‚‰çœ¼æ‰€çœ‹åˆ°çš„å­—ç¬¦ä¸ªæ•°ã€‚
2. **`charCodeAt`**ï¼š å¦‚æœçŒœæµ‹çš„æ²¡é”™ï¼Œå¯¹äº ğŸ’©ï¼Œå¯ä»¥åˆ†åˆ«å¾—å‡º`charCodeAt(0)`å’Œ`charCodeAt(1)`ï¼Œå®ƒä»¬çš„ç»“æœæ­£å¥½å°±æ˜¯ H å’Œ Lï¼š

   ```js
   'ğŸ’©'.charCodeAt(0).toString(16); // 0xD83D
   'ğŸ’©'.charCodeAt(1).toString(16); // 0xDCA9
   ```

3. **`fromCharcode`** - åªèƒ½å¤„ç†ä½äº BMP åŒºé—´(`U+0000`~`U+FFFF`)çš„`BMP`å­—ç¬¦,ä¼šç›´æ¥æˆªæ–­`SMPå­—ç¬¦`çš„é«˜ä½å­—èŠ‚:

   ```js
   String.fromCharCode(0x0041); // A
   String.fromCharCode(0x1f4a9); // 'ï’©'  U+F4A9, not U+1F4A9
   ```

   è§£å†³çš„åŠæ³•æ˜¯æ ¹æ®ä¸Šé¢è®¡ç®— `Hã€L` çš„å…¬å¼å…ˆè®¡ç®—å‡º `Hã€L`,ç„¶åå†ä¼ å…¥`String.fromCharCode`ï¼š

   ```js
   String.fromCharCode(0xd83d, 0xdca9); // "ğŸ’©"
   ```

4. **æ•°é‡åŒ¹é…`SMPå­—ç¬¦`**: åŒ¹é…å¤±è´¥çš„åŸå› æ˜¯ `SMPå­—ç¬¦`è¢«æ‰“æ•£æˆäº† Hã€L


    ```js
    /ğŸ’©{2}/   => /\uD83D\uDCA9{2}/  // å…¶å®åŒ¹é…çš„æ˜¯ H+L*2
    ```

    ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ç›´æ¥é‡‡ç”¨æ‹¬å·åŒ…è£¹å¯¹åº”çš„`<Hï¼ŒL>`æ¥å†™æ­£åˆ™

    ```js
    /(\uD83D\uDCA9){2}/.test('ğŸ’©ğŸ’©'); // true
    ```

5.  **èŒƒå›´åŒ¹é…`SMPå­—ç¬¦`**ï¼š æŠ¥é”™çš„åŸå› ä¹Ÿæ˜¯`Hã€L`ï¼š

        	```js
        	/[ğŸ’©-ğŸ’«]/  =>   /[\uD83D\uDCA9-\uD83D\uDCAB]/
        	```

    ä¸Šé¢çš„`\uDCA9-\uD83D`å·¦è¾¹çš„å€¼æ¯”å³è¾¹å¤§ï¼Œå¯¼è‡´æŠ¥é”™ã€‚ä¸€ä¸ªå¾ˆæŒ«çš„è§£å†³æ–¹æ¡ˆæ˜¯æä¾›ä»–ä»¬çš„ Hã€L å…¬å…±èŒƒå›´å¹¶ç²¾ç®€è¡¨è¾¾å¼ï¼š

        	```js
        	/\uD83D[\uDCA9-\uDCAB]/.test('ğŸ’©') // true
        	/\uD83D[\uDCA9-\uDCAB]/.test('ğŸ’«') // true
        	```

        	è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯¹äºä¸¤ä¸ªè·¨åº¦å¾ˆå¤§çš„`SMP`å­—ç¬¦ï¼Œéœ€è¦ç²¾å¿ƒçš„åˆ†æ®µï¼Œç¨ä¸ç•™ç¥å°±ä¼šå‡ºé”™ï¼š

        	```js
        	/[ğ„‘-ğŸ’«]/

        	=>

        	/\uD800[\uDD11-\uDFFF]|[\uD801-\uD83C][\uDC00-\uDFFF]|\uD83D[\uDC00-\uDCAB]/.test('ğŸ’ª') // true
        	```

6.  **`reverse`å‡½æ•°**ï¼šé‡åˆ°`SMPå­—ç¬¦`ä¼šç›´æ¥æŠŠ Hã€L é¢ å€’ï¼Œè€Œæ¯ä¸ªç‹¬ç«‹çš„ Hã€L éƒ½æ˜¯ã€ä¹±ç ã€ï¼Œåªæœ‰äºŒè€…ç»“åˆåœ¨ä¸€èµ·æ‰æœ‰æ„ä¹‰ã€‚å¦‚æœè¦è§£å†³é—®é¢˜ï¼Œéœ€è¦çŸ¥é“åœ¨ç¢°åˆ° H çš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªå­—ç¬¦ä¼šæ˜¯ Lï¼Œä¸è¦æŠŠäºŒè€…é¢ å€’å°±è¡Œã€‚

    ä¸è¿‡[esrever](https://github.com/mathiasbynens/esrever)æä¾›äº†ä¸€ä¸ªæ›´å·§å¦™çš„æ€è·¯ï¼šå…ˆå°† Hã€L é¢ å€’ä¸€æ¬¡ï¼Œç„¶åå†æ‰§è¡Œä¸€æ¬¡æ™®é€šçš„ reverse å³å¯ï¼š

    ```js
    const regexSurrogatePair = /([\uD800-\uDBFF])([\uDC00-\uDFFF])/g;

    function reverse(string) {
      const tempStr = string.replace(regexSurrogatePair, '$2$1');

      return tempStr
        .split('')
        .reverse()
        .join('');
    }

    console.log(reverse('abcd')); // dcba
    console.log(reverse('ğŸ’©ä¸‡å‡ çš®')); // çš®å‡ ä¸‡ğŸ’©â€‹â€‹â€‹â€‹â€‹
    ```

# ES6 ä¸­å¦‚ä½•è§£å†³ Unicode é—®é¢˜

åœ¨ es5 ä¸­å¤„ç† SMP å­—ç¬¦éœ€è¦æ—¶åˆ»è®°ä½ Hã€L çš„å­˜åœ¨ï¼Œæ—¢éº»çƒ¦åˆå®¹æ˜“å‡ºé”™ã€‚å¥½åœ¨ es6 ä¸­æ–°å¢äº†ä¸€ç³»åˆ—ç‰¹æ€§æ¥ä¸“é—¨å¤„ç† SMP å­—ç¬¦ï¼Œä¸‹é¢é€ä¸€è¯´æ˜ã€‚

## å­—ç¬¦è½¬ä¹‰

es5 ä¸­çš„`\u`å­—ç¬¦è½¬ä¹‰ä¸èƒ½æ­£ç¡®å¤„ç† SMP å­—ç¬¦ï¼Œä¾‹å¦‚ ğŸ˜„(`U+1F604, H=0xD83D L=0xDE04`)ï¼š

```js
'\u1F604'; // "á½ 4"   '\u1F60' + '4'
```

é™¤éä½¿ç”¨ Hã€L çš„å½¢å¼ï¼š

```js
'\uD83D\uDE04'; // ğŸ˜„
```

es6 ä¸­æä¾›äº†æ›´å¥½çš„æ–¹æ³•ï¼Œä½¿ç”¨`{}`åŒ…è£¹ä»£ç ç‚¹å³å¯ï¼š

```js
'\u{1f604}'; // ğŸ˜„
```

## codePointAt

`charCodeAt`åªèƒ½æ­£ç¡®è·å– BMP å­—ç¬¦çš„ä»£ç ç‚¹ï¼Œå¯¹äº SMP å­—ç¬¦åªèƒ½è·å– H æˆ– Lï¼›es6 ä¸­æ–°å¢çš„`codePointAt`,ä»–èƒ½ç»Ÿä¸€å¤„ç†å¥½ BMP ä»¥åŠ SMP å­—ç¬¦ï¼š

```js
'ğŸ˜„'.codePointAt(0).toString(16); // 0x1f604
'abc'.codePointAt(0).toString(16); // 0x0061
'å‘µå‘µå“’'.codePointAt(2).toString(16); // 0x54D2
```

## fromCodePoint

åŒæ ·çš„ï¼Œ`fromCharcode`ä¹Ÿåªèƒ½æ­£ç¡®å¤„ç† BMP å­—ç¬¦ï¼› es6 æ–°å¢çš„`fromCodePoint`è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š

```js
String.fromCodePoint(0x1f604); // ğŸ˜„
String.fromCodePoint(0x0061); // a
String.fromCodePoint(0x54d2); // å“’
```

## æ­£åˆ™åŒ¹é…

ES6 å¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†**`u`**ä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicode æ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`U+FFFF`çš„ SMP å­—ç¬¦ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨`u`ä¿®é¥°ç¬¦åŠ ä¸ŠåŸå§‹çš„ä»£ç ç‚¹æˆ–å­—ç¬¦å°±èƒ½æ­£ç¡®åŒ¹é…æ‰€æœ‰çš„ Unicode å­—ç¬¦äº†ã€‚

### å•å­—ç¬¦åŒ¹é…

è‹¥æ²¡æœ‰`u`ä¿®é¥°ç¬¦ï¼Œå³ä½¿ä½¿ç”¨ es6 ä¸­çš„å­—ç¬¦è½¬ä¹‰ä¹Ÿä¸èƒ½æ­£ç¡®åŒ¹é… SMP å­—ç¬¦ï¼š

```js
/\u{1f604}/.test('ğŸ˜„'); // false
```

ç”±äº Hã€L çš„å­˜åœ¨ï¼Œå³ä½¿`.`ç‚¹å·ä¹Ÿä¸èƒ½åŒ¹é… SMP å­—ç¬¦ï¼š

```js
/foo.bar/.test('fooğŸ˜„bar'); // false
```

ä½¿ç”¨`u`ä¿®é¥°ç¬¦å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š

```js
/\u{1f604}/u.test('ğŸ˜„'); // true
/foo.bar/u.test('fooğŸ˜„bar'); // true
```

### èŒƒå›´åŒ¹é…

ä¸Šé¢å·²ç»æåˆ°è¿‡ï¼Œåœ¨ es5 ä¸­ SMP èŒƒå›´åŒ¹é…ä¼šç›´æ¥æŠ¥é”™ï¼š

```js
/[ğŸ’©-ğŸ’«]/; // // Uncaught SyntaxError: Invalid regular expression: /[ğŸ’©-ğŸ’«]/: Range out of order in character class
```

`u`åœ¨è¿™é‡Œæ‰®æ¼”äº†æ•‘ä¸–ä¸»ï¼š

```js
// ğŸ’© 0x1f4a9 => H=0xD83D ,L=0xDCA9
// ğŸ’ª 0x1f4aa => H=0xD83D ,L=0xDCAA
// ğŸ’« 0x1f4ab => H=0xD83D ,L=0xDCAB

/[ğŸ’©-ğŸ’«]/u.test('ğŸ’©') // true
/[ğŸ’©-ğŸ’«]/u.test('ğŸ’ª') // true
/[ğŸ’©-ğŸ’«]/u.test('ğŸ’«') // true
```

ç›´æ¥ä½¿ç”¨ Hã€L çš„å½¢å¼æ¥å†™æ­£åˆ™ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼š

```js
/[\uD83D\uDCA9-\uD83D\uDCAB]/u.test('ğŸ’©') // true
/[\uD83D\uDCA9-\uD83D\uDCAB]/u.test('ğŸ’ª') // true
/[\uD83D\uDCA9-\uD83D\uDCAB]/u.test('ğŸ’«') // true
```

### æ•°é‡åŒ¹é…

å¤ä¹ ä¸€ä¸‹ es5 åœ¨æ•°é‡åŒ¹é… SMP æ—¶çš„é—®é¢˜ï¼š

```js
/ğŸ˜„{2}/.test('ğŸ˜„ğŸ˜„'); // false
```

ç»§ç»­çœ‹çœ‹`u`çš„ä½œç”¨ï¼š

```js
/ğŸ˜„{2}/u.test('ğŸ˜„ğŸ˜„') // true
/\u{1f604}{2}/u.test('ğŸ˜„ğŸ˜„') // true
/\uD83D\uDE04{2}/u.test('ğŸ˜„ğŸ˜„') // true ï¼Œ æ³¨æ„è¿™é‡Œæ²¡æœ‰ä½¿ç”¨æ‹¬å·
```

## è¡¨å•æ ¡éªŒä¸­çš„ pattern

åœ¨è¡¨å•æ ¡éªŒä¸­ï¼Œ`input`å…ƒç´ æœ‰ä¸€ä¸ªè§„åˆ™å±æ€§æ˜¯`pattern`ï¼Œå¯ä»¥ç»™å®ƒè®¾ç½®ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè‹¥è¡¨å•é¡¹çš„å€¼åŒ¹é…äº†`pattern`ï¼Œä¼šé»˜è®¤æ·»åŠ ä¸€ä¸ª`valid`çš„ä¼ªç±»ï¼Œåä¹‹æ·»åŠ `invalid`ä¼ªç±»ã€‚

```html
<style>
	:invalid {
	  color: red;
	}
	:valid {
	 color: green;
	}
</style>
```

```html
<form action="">
    <input type="text" pattern="\d+" value="123"> <!-- ç•Œé¢ä¸Šæ˜¾ç¤ºç»¿è‰² -->
    <input type="text" pattern="\d+" value="abc"> <!-- ç•Œé¢ä¸Šæ˜¾ç¤ºçº¢è‰² -->
 </form>
```

å¹¸è¿çš„æ˜¯ï¼Œä¸éœ€è¦æˆ‘ä»¬åšä»€ä¹ˆ hack æ“ä½œï¼Œ`u`ä¿®é¥°ç¬¦å·²ç»é»˜è®¤é™„åŠ åœ¨äº† pattern ä¸Šï¼š

```html
<form action="" class="form">
	<input type="text" pattern='ğŸ˜„{2}' value="ğŸ˜„ğŸ˜„">  <!-- green -->
	<input type="text" pattern="ğŸ’©-ğŸ’«" value="ğŸ’«"> <!-- green -->
</form>
```

## å…¼å®¹æ€§

`u`ä¿®é¥°ç¬¦çš„å…¼å®¹æ€§å‚è€ƒ[test-RegExp_y_and_u_flags](http://kangax.github.io/compat-table/es6/#test-RegExp_y_and_u_flags)

![](https://hellogithub2014.github.io/assets/img/Unicode/u-flag-compatiable.png)

## Array.from

å¯èƒ½æœ‰æ—¶å€™éœ€è¦è®¡ç®—å­—ç¬¦ä¸²ä¸­çš„ã€å­—æ•°ã€(å³è‚‰çœ¼è§åˆ°çš„å­—ç¬¦æ•°)ï¼Œä¾‹å¦‚ç•Œé¢æç¤ºç”¨æˆ·è¾“å…¥äº†å¤šå°‘å­—ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™ä¸ªæ—¶å€™ä¸èƒ½ç®€å•çš„ä½¿ç”¨`length`å±æ€§ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ª`SMP`å­—ç¬¦å®ƒä¼šè¿”å› 2.

åœ¨ es5 ä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š

```js
var regexSMP = /[\uD800-\uDBFF][\uDC00-\uDFFF]/g;

// å°†æ¯ä¸ªSMPå­—ç¬¦è½¬æ¢æˆä¸€ä¸ªBMPå­—ç¬¦ï¼Œç„¶åç›´æ¥è®¡ç®—æœ€ç»ˆç»“æœçš„lengthå³å¯ã€‚
function countSymbols(string) {
  return string.replace(regexSMP, '_').length;
}

countSymbols('ğŸ˜„ä½ å¥½é˜¿ï¼ŒtestÂ©'); // 10
```

es6 ä¸­å€ŸåŠ©`Array.from`æˆ–è€…æ‰©æ•£è¿ç®—ç¬¦`...`å¯ä»¥æ›´ç®€ä¾¿ï¼Œä»–ä¼šå¸®åŠ©æˆ‘ä»¬å¤„ç†å¥½ Unicode å­—ç¬¦ï¼š

```js
function countSymbols2(string) {
  return Array.from(string).length;
}

countSymbols2('ğŸ˜„ä½ å¥½é˜¿ï¼ŒtestÂ©'); // 10

function countSymbols3(string) {
  return [...string].length;
}

countSymbols3('ğŸ˜„ä½ å¥½é˜¿ï¼ŒtestÂ©'); // 10
```

åŒæ ·`reverse`å‡½æ•°ä¹Ÿèƒ½ç”¨`Array.from`ï¼š

```js
function reverse2(string) {
  return Array.from(string)
    .reverse()
    .join('');
}
reverse2('ğŸ˜„ä½ å¥½é˜¿ï¼ŒtestÂ©'); // "Â©tsetï¼Œé˜¿å¥½ä½ ğŸ˜„"
```

# å‚è€ƒ

1.  [javascript-unicode](https://mathiasbynens.be/notes/javascript-unicode)
2.  [è°ˆè°ˆ Unicode ç¼–ç ](http://pcedu.pconline.com.cn/empolder/gj/other/0505/616631_all.html#content_page_1)
3.  [Unicode ä¸ JavaScript è¯¦è§£](http://www.ruanyifeng.com/blog/2014/12/unicode.html)
4.  [wiki unicode](https://en.wikipedia.org/wiki/Unicode)
5.  [The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets](https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/)
6.  [Unicode-aware regular expressions in ES2015](https://mathiasbynens.be/notes/es6-unicode-regex)
7.  [es6 å­—ç¬¦ä¸²çš„æ‰©å±•](http://es6.ruanyifeng.com/#docs/string)
8.  [es6 æ­£åˆ™çš„æ‰©å±•](http://es6.ruanyifeng.com/#docs/regex)
9.  [ASCIIï¼ŒUnicode å’Œ UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
