<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="MpEos65SsDadcqkPQvdQGXTTDcUJqQhcC2OpPRp4quU">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Unicode,">










<meta name="description" content="在国际化业务中总有很多地方需要做本地化，比如地域列表在不同国家地区的展现，在英语国家更习惯A-Z的排序，国内更习惯拼音排序。再精细一些的业务场景中，会遵循专业翻译人员的意见给出更本地化的排序，比如法语、意大利中会有很多带音调的字母如Â、ñ、Ï。 本文会尝试手动实现这样的排序标准，看看其中有哪些坑，并给出最终的方案。 排序标准排序最核心的就是确定不同语言下的排序标准，这个是交给专业翻译来确定的，同时">
<meta name="keywords" content="Unicode">
<meta property="og:type" content="article">
<meta property="og:title" content="多语言排序">
<meta property="og:url" content="https://hellogithub2014.github.io/2019/12/25/linguistic-sorting/index.html">
<meta property="og:site_name" content="十年一刻">
<meta property="og:description" content="在国际化业务中总有很多地方需要做本地化，比如地域列表在不同国家地区的展现，在英语国家更习惯A-Z的排序，国内更习惯拼音排序。再精细一些的业务场景中，会遵循专业翻译人员的意见给出更本地化的排序，比如法语、意大利中会有很多带音调的字母如Â、ñ、Ï。 本文会尝试手动实现这样的排序标准，看看其中有哪些坑，并给出最终的方案。 排序标准排序最核心的就是确定不同语言下的排序标准，这个是交给专业翻译来确定的，同时">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/origin-sort.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/case-sensitive-sort.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/case-sensitive-error-pt.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/case-sensitive-correct-pt.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/accent-sort-error-fr.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/ligature-correct-fr.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/stroke-letter-error-pl.png">
<meta property="og:image" content="https://hellogithub2014.github.io/images/lang-sort/lodash-deblurr-mapping.png">
<meta property="og:updated_time" content="2020-01-18T02:10:33.912Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="多语言排序">
<meta name="twitter:description" content="在国际化业务中总有很多地方需要做本地化，比如地域列表在不同国家地区的展现，在英语国家更习惯A-Z的排序，国内更习惯拼音排序。再精细一些的业务场景中，会遵循专业翻译人员的意见给出更本地化的排序，比如法语、意大利中会有很多带音调的字母如Â、ñ、Ï。 本文会尝试手动实现这样的排序标准，看看其中有哪些坑，并给出最终的方案。 排序标准排序最核心的就是确定不同语言下的排序标准，这个是交给专业翻译来确定的，同时">
<meta name="twitter:image" content="https://hellogithub2014.github.io/images/lang-sort/origin-sort.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'Z5V8KL0XIZ',
      apiKey: '88610a56e4ab954825661f14975c6a43',
      indexName: 'hexo-blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hellogithub2014.github.io/2019/12/25/linguistic-sorting/">





  <title>多语言排序 | 十年一刻</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?41d97f95198aa53fcbe7f25b20a44ee3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





  
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">十年一刻</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hellogithub2014.github.io/2019/12/25/linguistic-sorting/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu Bin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1544633647623&di=9344c3068a2e155434bd39899d7cd25d&imgtype=0&src=http%3A%2F%2Fpic65.nipic.com%2Ffile%2F20150428%2F12641788_080744824000_2.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十年一刻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">多语言排序</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-25T18:35:30+08:00">
                2019-12-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/25/linguistic-sorting/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/25/linguistic-sorting/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在国际化业务中总有很多地方需要做本地化，比如地域列表在不同国家地区的展现，在英语国家更习惯<code>A-Z</code>的排序，国内更习惯拼音排序。再精细一些的业务场景中，会遵循专业翻译人员的意见给出更本地化的排序，比如法语、意大利中会有很多带音调的字母如<code>Â</code>、<code>ñ</code>、<code>Ï</code>。</p>
<p>本文会尝试手动实现这样的排序标准，看看其中有哪些坑，并给出最终的方案。</p>
<h1 id="排序标准"><a href="#排序标准" class="headerlink" title="排序标准"></a>排序标准</h1><p>排序最核心的就是确定不同语言下的排序标准，这个是交给专业翻译来确定的，同时可能会结合具体业务做细节上的调整。下面给一些在我所在业务部分语种的排序标准。</p>
<p>英语:<br><code>A a B b C c D d E e F f G g H h I i J j K k L l M m N n O o P p Q q R r S s T t U u V v W w X x Y y Z z</code></p>
<p>日语：<br><code>あ、い、う、え、お、か、き、く、け、こ、さ、し、す、せ、そ、た、ち、つ、て、と、な、に、ぬ、ね、の、は、ひ、ふ、へ、ほ、ま、み、む、め、も、や、ゆ、よ、ら、り、る、れ、ろ、わ、を、ん</code></p>
<p>葡萄牙语：</p>
<p><code>A a Á á B b C c D d E e É é F f G g H h I i Í í J j K k L l M m N n O o Ó ó P p Q q R r S s T t U u Ú ú V v W w X x Y y Z z</code></p>
<p>俄语：<br><code>А Б В Г Д Е Ё Ж З И Й К Л М Н О П Р С Т У Ф Х Ц Ч Ш Щ Ъ Ы Ь Э Ю Я</code></p>
<h1 id="排序函数"><a href="#排序函数" class="headerlink" title="排序函数"></a>排序函数</h1><h3 id="内置-sort"><a href="#内置-sort" class="headerlink" title="内置 sort"></a>内置 sort</h3><p><code>js</code>内置支持<code>sort</code>方法，不过它内部的排序标准比较简单，只是将两个参数相减，如果前者比后者小就返回负数。直接将<code>sort</code>应用于英文的排序发现就产生了不一致：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sort1</span>(<span class="params">arr, locale</span>) </span>&#123;</span><br><span class="line">  arr.sort();</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/lang-sort/origin-sort.png" alt="origin-sort.png"></p>
<p>当然仅仅修复英文的排序还是比较简单的，只需针对大小写做一些特殊判断。</p>
<h3 id="修复大小写优先级"><a href="#修复大小写优先级" class="headerlink" title="修复大小写优先级"></a>修复大小写优先级</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sort2</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  arr.sort(<span class="function">(<span class="params">char1, char2</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// A &lt; a</span></span><br><span class="line">    <span class="keyword">if</span> (char1.toLowerCase() === char2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// a &gt; A</span></span><br><span class="line">    <span class="keyword">if</span> (char1.toUpperCase() === char2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全部用小写来比较code point</span></span><br><span class="line">    <span class="keyword">const</span> lower1 = char1.toLowerCase();</span><br><span class="line">    <span class="keyword">const</span> lower2 = char2.toLowerCase();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cp1 = lower1.codePointAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> cp2 = lower2.codePointAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> cp1 - cp2;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/lang-sort/case-sensitive-sort.png" alt="case-sensitive-sort"></p>
<p>实际上这段排序可以满足我们业务的英语、德语、日语、韩语、马拉西亚、泰语、印度尼西亚、阿拉伯语的排序标准。</p>
<p>但是所有含有音调符的语言，排序全部会失败, 因为那些字母的码点比<code>A-Za-z</code>都要大：</p>
<p><img src="/images/lang-sort/case-sensitive-error-pt.png" alt="case-sensitive-error-pt"></p>
<h3 id="修复音调字符"><a href="#修复音调字符" class="headerlink" title="修复音调字符"></a>修复音调字符</h3><p>音调符通常不改变原字符的意义，只是改变它的读音，类似于拼音里的<code>Ā Á Ǎ À</code>，<a href="https://emw3.com/unicode-accents.html" target="_blank" rel="noopener">一些变音符的示范</a>。</p>
<p>这些变音符很多都是由基础字符+专门的音调符组合而成的，而且组合而成的字符也是一个专门的<code>Unicode</code>字符, 他们在<code>js</code>的长度也是 1，没有办法直接拆开。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"À"</span>.length; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>幸而<code>es6</code>中针对<code>Unicode</code>字符出了一系列专门的函数，其中就有一个专门用于合成、分解这种变音符的函数<a href="https://es6.ruanyifeng.com/#docs/string-methods" target="_blank" rel="noopener"><code>normalize</code></a></p>
<p>可以给其传入特定的字符串<code>NFD</code>表示“标准等价分解”，还有另一个差不多的<code>NFKD</code>，二者差别不大。比如<code>À</code>的分解结果如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> normalized = <span class="string">"À"</span>.normalize(<span class="string">"NFD"</span>);</span><br><span class="line">normalized[<span class="number">0</span>].codePointAt(<span class="number">0</span>).toString(<span class="number">16</span>); <span class="comment">// 0x0041</span></span><br><span class="line">normalized[<span class="number">1</span>].codePointAt(<span class="number">0</span>).toString(<span class="number">16</span>); <span class="comment">// 0x0300  这就是分解出来的音调符</span></span><br></pre></td></tr></table></figure>
<p>那么利用<code>normalize</code>我们就可以处理变音符号了，修改后的<code>sort</code>方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sort3</span>(<span class="params">arr, locale</span>) </span>&#123;</span><br><span class="line">  arr.sort(<span class="function">(<span class="params">char1, char2</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// NFD 标准等价分解: 即在标准等价的前提下，返回合成字符分解的多个简单字符。</span></span><br><span class="line">    <span class="keyword">const</span> r1 = <span class="regexp">/(\P&#123;Mark&#125;)(\p&#123;Mark&#125;+)?/gu</span>.exec(char1.normalize(<span class="string">"NFD"</span>)) || [</span><br><span class="line">      char1,</span><br><span class="line">      char1</span><br><span class="line">    ]; <span class="comment">// exec匹配失败返回null</span></span><br><span class="line">    <span class="keyword">const</span> r2 = <span class="regexp">/(\P&#123;Mark&#125;)(\p&#123;Mark&#125;+)?/gu</span>.exec(char2.normalize(<span class="string">"NFD"</span>)) || [</span><br><span class="line">      char2,</span><br><span class="line">      char2</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> base1 = r1[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> base2 = r2[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> accent1 = r1[<span class="number">2</span>]; <span class="comment">// accent可能不存在</span></span><br><span class="line">    <span class="keyword">const</span> accent2 = r2[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全部用小写来比较code point</span></span><br><span class="line">    <span class="keyword">const</span> lowerBase1 = base1.toLowerCase();</span><br><span class="line">    <span class="keyword">const</span> lowerBase2 = base2.toLowerCase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对 A À Á 或 a à á的情况</span></span><br><span class="line">    <span class="keyword">if</span> (base1 === base2) &#123;</span><br><span class="line">      <span class="keyword">return</span> simpleAccentCompare(accent1, accent2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A &lt; a、Á &lt; á、A &lt; á、 Á &gt; a</span></span><br><span class="line">    <span class="keyword">if</span> (base1.toLowerCase() === base2) &#123;</span><br><span class="line">      <span class="keyword">if</span> (accent1 &amp;&amp; !accent2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// a &gt; A、á &gt; Á、á &gt; A、 a &lt; Á、</span></span><br><span class="line">    <span class="keyword">if</span> (base1.toUpperCase() === base2) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!accent1 &amp;&amp; accent2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cp1 = lowerBase1.codePointAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> cp2 = lowerBase2.codePointAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> cp1 - cp2;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单纯比较音调符本身</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">simpleAccentCompare</span>(<span class="params">accent1, accent2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!accent1 &amp;&amp; !accent2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!accent1) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!accent2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> accent1.codePointAt(<span class="number">0</span>) - accent2.codePointAt(<span class="number">0</span>); <span class="comment">// 只比较二者在Unicode字符集中的位置顺序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>sort2</code>方法的基础上，可以解决葡萄牙、俄国、西班牙语、菲律宾这些语种的排序。</p>
<p><img src="/images/lang-sort/case-sensitive-correct-pt.png" alt="case-sensitive-correct-pt"></p>
<p><code>\p{Mark}</code>是<code>es6</code>新增的正则表达式特性: <a href="https://es6.ruanyifeng.com/#docs/regex" target="_blank" rel="noopener"><code>Unicode属性类</code></a>。</p>
<p>注意：<code>simpleAccentCompare</code>在比较音调符时只单纯比较了码点大小，如果业务上有要求更个性化的排序标准，可以建立一个音调符的优先级映射表。</p>
<p>但在法语的标准中，遇到了一些比音调符更奇怪的字符。。。</p>
<p><img src="/images/lang-sort/accent-sort-error-fr.png" alt="accent-sort-error-fr"></p>
<p>经过搜索，他们是捆绑字符<a href="https://en.wikipedia.org/wiki/Orthographic_ligature#Ligatures_in_Unicode_(Latin_alphabets" target="_blank" rel="noopener"><code>Ligature characters</code></a>&gt;).</p>
<h3 id="修复捆绑字符"><a href="#修复捆绑字符" class="headerlink" title="修复捆绑字符"></a>修复捆绑字符</h3><p>捆绑字符将两个或多个字母连在一块，看起来就像是书写时将他们连在一起了。捆绑字符的形式多种多样，而且经过测试<code>normalize</code>也无法处理这种字符。。。</p>
<p>不过业务中通常不会出现这么多捆绑字符，比如翻译人员给的完整排序标准中只有 <code>4</code> 个，翻译文案绝大多数情况下只会使用基本的<code>A-Za-z</code>。作为变通我们可以建立一个映射表将捆绑字符分解，与<a href="https://lexsrv3.nlm.nih.gov/LexSysGroup/Projects/lvg/2014/docs/designDoc/UDF/unicode/NormOperations/splitLigatures.html" target="_blank" rel="noopener">这篇文章</a>的思路是相同的。 比如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LIGATURE_MAP = &#123;</span><br><span class="line">  Æ: <span class="string">"AE"</span>, <span class="comment">// U+00C6 LATIN CAPITAL LETTER AE</span></span><br><span class="line">  æ: <span class="string">"ae"</span>, <span class="comment">// U+00E6 LATIN SMALL LETTER AE</span></span><br><span class="line">  Œ: <span class="string">"OE"</span>, <span class="comment">// U+0152 LATIN CAPITAL LIGATURE OE</span></span><br><span class="line">  œ: <span class="string">"oe"</span>, <span class="comment">// U+0153 LATIN SMALL LIGATURE OE</span></span><br><span class="line">  ƕ: <span class="string">"hv"</span>, <span class="comment">// U+0195 LATIN SMALL LETTER HV</span></span><br><span class="line">  Ƣ: <span class="string">"OI"</span>, <span class="comment">// U+01A2 LATIN CAPITAL LETTER OI</span></span><br><span class="line">  ƣ: <span class="string">"oi"</span>, <span class="comment">// U+01A3 LATIN SMALL LETTER OI</span></span><br><span class="line">  Ʀ: <span class="string">"YR"</span>, <span class="comment">// U+01A6 LATIN LETTER YR</span></span><br><span class="line">  Ȣ: <span class="string">"OU"</span>, <span class="comment">// U+0222 LATIN CAPITAL LETTER OU</span></span><br><span class="line">  ȣ: <span class="string">"ou"</span>, <span class="comment">// U+0223 LATIN SMALL LETTER OU</span></span><br><span class="line">  ȸ: <span class="string">"db"</span>, <span class="comment">// U+0238 LATIN SMALL LETTER DB DIGRAPH</span></span><br><span class="line">  ȹ: <span class="string">"qp"</span>, <span class="comment">// U+0239 LATIN SMALL LETTER QP DIGRAPH</span></span><br><span class="line">  ɶ: <span class="string">"OE"</span>, <span class="comment">// U+0276 LATIN LETTER SMALL CAPITAL OE</span></span><br><span class="line">  ʣ: <span class="string">"DZ"</span>, <span class="comment">// U+02A3 LATIN SMALL LETTER DZ DIGRAPH</span></span><br><span class="line">  ʦ: <span class="string">"ts"</span>, <span class="comment">// U+02A6 LATIN SMALL LETTER TS DIGRAPH</span></span><br><span class="line">  ʪ: <span class="string">"ls"</span>, <span class="comment">// U+02AA LATIN SMALL LETTER LS DIGRAPH</span></span><br><span class="line">  ʫ: <span class="string">"lz"</span> <span class="comment">// U+02AB LATIN SMALL LETTER LZ DIGRAPH</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>所以我们的<code>sort</code>可以改一改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compareChar</span>(<span class="params">char1, char2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!char1 &amp;&amp; !char2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!char1) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!char2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// NFD 标准等价分解: 即在标准等价的前提下，返回合成字符分解的多个简单字符。</span></span><br><span class="line">  <span class="keyword">const</span> regexp = <span class="regexp">/([A-Za-z])([\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff])?/gu</span>; <span class="comment">// \u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff 常见音调符</span></span><br><span class="line">  <span class="keyword">const</span> r1 = regexp.exec(char1.normalize(<span class="string">"NFD"</span>)) || [char1, char1]; <span class="comment">// exec匹配失败返回null</span></span><br><span class="line">  regexp.lastIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> r2 = regexp.exec(char2.normalize(<span class="string">"NFD"</span>)) || [char2, char2];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> base1 = r1[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> base2 = r2[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> accent1 = r1[<span class="number">2</span>]; <span class="comment">// accent可能不存在</span></span><br><span class="line">  <span class="keyword">const</span> accent2 = r2[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果是捆绑字符，使用分解后的形式来对比</span></span><br><span class="line">  <span class="keyword">const</span> splited1 = LIGATURE_MAP[char1];</span><br><span class="line">  <span class="keyword">const</span> splited2 = LIGATURE_MAP[char2];</span><br><span class="line">  <span class="keyword">if</span> (splited1 &amp;&amp; splited2) &#123;</span><br><span class="line">    <span class="keyword">return</span> compareStr(splited1, splited2); <span class="comment">// splited1和splited1都是包含多个字符的字符串了，递归调用</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (splited1) &#123;</span><br><span class="line">    <span class="comment">// 基准字符一致的情况下，捆绑字符比单个字符要靠后， 如 A a À â Æ</span></span><br><span class="line">    <span class="keyword">if</span> (splited1[<span class="number">0</span>].toLowerCase() === base2.toLowerCase()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> compareStr(splited1, char2);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (splited2) &#123;</span><br><span class="line">    <span class="comment">// 基准字符一致的情况下，捆绑字符比单个字符要靠后， 如 A a À â Æ</span></span><br><span class="line">    <span class="keyword">if</span> (base1.toLowerCase() === splited2[<span class="number">0</span>].toLowerCase()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> compareStr(char1, splited2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 全部用小写来比较code point</span></span><br><span class="line">  <span class="keyword">const</span> lowerBase1 = base1.toLowerCase();</span><br><span class="line">  <span class="keyword">const</span> lowerBase2 = base2.toLowerCase();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 针对 A À Á 或 a à á的情况</span></span><br><span class="line">  <span class="keyword">if</span> (base1 === base2) &#123;</span><br><span class="line">    <span class="keyword">return</span> simpleAccentCompare(accent1, accent2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A &lt; a、Á &lt; á、A &lt; á、 Á &gt; a</span></span><br><span class="line">  <span class="keyword">if</span> (base1.toLowerCase() === base2) &#123;</span><br><span class="line">    <span class="keyword">if</span> (accent1 &amp;&amp; !accent2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (accent1 &amp;&amp; accent2) &#123;</span><br><span class="line">      <span class="keyword">return</span> simpleAccentCompare(accent1, accent2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// a &gt; A、á &gt; Á、á &gt; A、 a &lt; Á、</span></span><br><span class="line">  <span class="keyword">if</span> (base1.toUpperCase() === base2) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!accent1 &amp;&amp; accent2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (accent1 &amp;&amp; accent2) &#123;</span><br><span class="line">      <span class="keyword">return</span> simpleAccentCompare(accent1, accent2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> cp1 = lowerBase1.codePointAt(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> cp2 = lowerBase2.codePointAt(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> cp1 - cp2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compareStr</span>(<span class="params">str1 = <span class="string">""</span>, str2 = <span class="string">""</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> casted1 = <span class="built_in">Array</span>.from(str1);</span><br><span class="line">  <span class="keyword">const</span> casted2 = <span class="built_in">Array</span>.from(str2);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 长度补齐</span></span><br><span class="line">  <span class="keyword">if</span> (casted1.length &lt; casted2.length) &#123;</span><br><span class="line">    casted1.push(...new <span class="built_in">Array</span>(casted2.length - casted1.length).fill(<span class="literal">undefined</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> diff = casted1.map(<span class="function">(<span class="params">val, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = compareChar(val, casted2[index]);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> first = diff.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item !== <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 两个数组完全一样</span></span><br><span class="line">  <span class="keyword">if</span> (first &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> diff[first];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sort4</span>(<span class="params">arr, locale</span>) </span>&#123;</span><br><span class="line">  arr.sort(compareStr);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就修复了捆绑字符的问题：</p>
<p><img src="/images/lang-sort/ligature-correct-fr.png" alt="ligature-correct-fr"></p>
<p>正当以为坑都踩完了，<code>Unicode</code>告诉我<code>too young too simple, sometimes naive</code>，给我一记重拳。。。还有更大的坑等着我</p>
<p><img src="/images/lang-sort/stroke-letter-error-pl.png" alt="stroke-letter-error-pl"></p>
<h3 id="stroke-letter"><a href="#stroke-letter" class="headerlink" title="stroke letter"></a><code>stroke letter</code></h3><p>这种字符中间带一个横杠的，也不知道该怎么称呼，就叫<code>stroke letter</code>吧,在<code>Unicode</code>中还挺多的,<a href="https://unicode-search.net/unicode-namesearch.pl?term=BAR" target="_blank" rel="noopener">给一些例子</a></p>
<p><code>stroke letter</code>无法用<code>normalize</code>分解，数量众多也不大好建立映射表，看起来是没有办法的。</p>
<p>无意中看到<a href="https://lodash.com/docs/4.17.15#deburr" target="_blank" rel="noopener"><code>lodash.deblurr</code>方法</a>，函数注释中说可以处理所有在 <a href="https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block" target="_blank" rel="noopener">Latin-1 Supplement</a>#Character_table&gt;) and <a href="https://en.wikipedia.org/wiki/Latin_Extended-A" target="_blank" rel="noopener">Latin Extended-A letters</a>这里两个<code>script</code>的字符，去掉所有<a href="https://en.wikipedia.org/wiki/Combining_Diacritical_Marks" target="_blank" rel="noopener"><code>combining diacritical marks</code></a>， 其中就包含很多<code>stroke letter</code>. 它是怎么做的呢？</p>
<p>查看源码可以得知核心的一句是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deburr</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">  string = toString(string);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    string &amp;&amp; string.replace(reLatin, deburrLetter).replace(reComboMark, <span class="string">""</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>string.replace(reLatin, deburrLetter)</code>是讲所有变音符、<code>stroke letter</code>暴力替换为<code>素颜</code>形式，比如<code>Ł --&gt; L</code>。它在内部维护了一个很大的映射表，基于它来做暴力替换，所以它也只处理了两个<code>script</code>的字符。实在是力不从心。。。</p>
<p><img src="/images/lang-sort/lodash-deblurr-mapping.png" alt="lodash-deblurr-mapping"></p>
<p>到这里要反思是不是思路不对？目前都是从字符本身着手的，所以需要处理各种各样奇怪的<code>Unicode</code>字符，边界情况非常的多。</p>
<h3 id="localeCompare"><a href="#localeCompare" class="headerlink" title="localeCompare"></a>localeCompare</h3><p>换个思路，在业务场景中更多的是<strong>先定下来整个页面的语种，然后再基于这个语种来对文案进行排序</strong>。也就是说如果页面是日文的，即使文案本身是韩文，也将韩文按照日文的排序标准来排序。 有没有一些能在给定语种的情况下排序的开源库或者函数呢？</p>
<p>在<code>stackoverflow</code>上搜索果然有相关问题,<a href="https://stackoverflow.com/questions/12624532/locale-based-sort-in-javascript-sort-accented-letters-and-other-variants-in-a-p" target="_blank" rel="noopener">比如这个</a>。其中提到了<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare" target="_blank" rel="noopener"><code>localeCompare</code></a>和<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator" target="_blank" rel="noopener"><code>Intl.Collator</code></a>，看了下<code>MDN</code>二者其实差不多，传的参数也是一样的。以下就只讨论<code>localeCompare</code>。</p>
<p>函数声明是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">referenceStr.localeCompare(compareString[, locales[, options]])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>locales</code>参数表明按照什么语种来排序，可以传递数组</li>
<li><code>options</code>提供细节控制，比如<ul>
<li><code>sensitivity</code> 是否忽略大小写，是否忽略音调符等等</li>
<li><code>caseFirst</code> 大写优先还是小写优先</li>
<li><code>numeric</code> 数字是否参与比较</li>
</ul>
</li>
</ul>
<p>稍微棘手的是<code>locales</code>改怎么传，文档中给了一些<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation" target="_blank" rel="noopener"><code>参考链接</code></a>以及<a href="http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry" target="_blank" rel="noopener"><code>language-subtag-registry</code></a>，不过这两还是不大清晰易懂，经过努力又找到另一个文档<a href="http://www.lingoes.net/zh/translator/langcode.htm" target="_blank" rel="noopener"><code>language code</code></a>。</p>
<p>我们试试它的效果如何：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sort5</span>(<span class="params">arr, locale</span>) </span>&#123;</span><br><span class="line">  arr.sort(<span class="function">(<span class="params">str1, str2</span>) =&gt;</span></span><br><span class="line">    str1.localeCompare(str2, locale, &#123;</span><br><span class="line">      caseFirst: <span class="string">"upper"</span>, <span class="comment">// 大写优先</span></span><br><span class="line">      numeric: <span class="literal">true</span>, <span class="comment">// 比较数字</span></span><br><span class="line">      ignorePunctuation: <span class="literal">true</span> <span class="comment">// 忽略标点符号</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>令人感到惊喜的是<code>stroke letter</code>、捆绑字符、音调符都很好的处理了，只有一小部分的细节与翻译人员定的标准不一致，基本都是多个音调符的顺序不一致。可能是<code>locale</code>设置的不对，也可能是标准本身定的就不是很准确。不一致的部分可以和 PM 沟通看看是否可以接收，因为业务中很有可能是不会出现那些音调符的。</p>
<p>真香！</p>
<p>后续 TODO: 研究 V8 中的<code>localeCompare</code>源码。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文探索了手写一个多语言排序函数具体会遇到哪些坑，并在最后使用<code>localeCompare</code>满足了业务需求。本文所有涉及代码和排序在<a href="https://github.com/hellogithub2014/hellogithub2014.github.io/tree/save/source/_assets/lang-sort/lang-sort.html" target="_blank" rel="noopener">这里</a>，右键查看源码即可。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Unicode/" rel="tag"># Unicode</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/27/rrweb-source-code-1/" rel="next" title="rrweb源码解析1">
                <i class="fa fa-chevron-left"></i> rrweb源码解析1
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/18/analysis-tree-component/" rel="prev" title="一种Tree组件的实现方式">
                一种Tree组件的实现方式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c2f329e843996fd" async="async"></script>
</div>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1544633647623&di=9344c3068a2e155434bd39899d7cd25d&imgtype=0&src=http%3A%2F%2Fpic65.nipic.com%2Ffile%2F20150428%2F12641788_080744824000_2.jpg" alt="Liu Bin">
            
              <p class="site-author-name" itemprop="name">Liu Bin</p>
              <p class="site-description motion-element" itemprop="description">码畜</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">83</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">65</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#排序标准"><span class="nav-number">1.</span> <span class="nav-text">排序标准</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#排序函数"><span class="nav-number">2.</span> <span class="nav-text">排序函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内置-sort"><span class="nav-number">2.0.1.</span> <span class="nav-text">内置 sort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修复大小写优先级"><span class="nav-number">2.0.2.</span> <span class="nav-text">修复大小写优先级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修复音调字符"><span class="nav-number">2.0.3.</span> <span class="nav-text">修复音调字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修复捆绑字符"><span class="nav-number">2.0.4.</span> <span class="nav-text">修复捆绑字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stroke-letter"><span class="nav-number">2.0.5.</span> <span class="nav-text">stroke letter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#localeCompare"><span class="nav-number">2.0.6.</span> <span class="nav-text">localeCompare</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Bin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://orangeeeee.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://hellogithub2014.github.io/2019/12/25/linguistic-sorting/';
          this.page.identifier = '2019/12/25/linguistic-sorting/';
          this.page.title = '多语言排序';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://orangeeeee.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
